(()=>{var e={};e.id=947,e.ids=[947],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},3244:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(7798),r(6886),r(1930),r(5866);var s=r(3191),a=r(8716),n=r(7922),l=r.n(n),i=r(5231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let d=["",{children:["voice-chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7798)),"/Users/saud06/CascadeProjects/german-ai/frontend/src/app/voice-chat/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7026))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,6886)),"/Users/saud06/CascadeProjects/german-ai/frontend/src/app/layout.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,1930)),"/Users/saud06/CascadeProjects/german-ai/frontend/src/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7026))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/saud06/CascadeProjects/german-ai/frontend/src/app/voice-chat/page.tsx"],u="/voice-chat/page",x={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/voice-chat/page",pathname:"/voice-chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7012:(e,t,r)=>{Promise.resolve().then(r.bind(r,933)),Promise.resolve().then(r.bind(r,6618)),Promise.resolve().then(r.bind(r,6833)),Promise.resolve().then(r.bind(r,2643))},772:(e,t,r)=>{"use strict";var s=r(7577);r.o(s,"useEffect")&&r.d(t,{useEffect:function(){return s.useEffect}}),r.o(s,"useRef")&&r.d(t,{useRef:function(){return s.useRef}}),r.o(s,"useState")&&r.d(t,{useState:function(){return s.useState}})},6833:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(326),a=r(772),n=r(5047);function l(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)([]),[l,i]=(0,a.useState)(!1),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[x,p]=(0,a.useState)(null),[m,h]=(0,a.useState)(null),f=(0,a.useRef)(null),g=(0,a.useRef)([]),b=(0,a.useRef)(null),y=(0,a.useRef)(null);(0,a.useEffect)(()=>{j()},[]),(0,a.useEffect)(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[t]);let j=async()=>{try{let e=await fetch("http://localhost:8000/api/v1/voice/status"),t=await e.json();h(t),t.voice_features_enabled||p("Voice features are not enabled on the server. Please ensure Whisper and Piper services are running.")}catch(e){p("Failed to check voice service status. Please ensure the backend is running."),console.error(e)}},v=async()=>{try{p(null);let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);f.current=t,g.current=[],t.ondataavailable=e=>{e.data.size>0&&g.current.push(e.data)},t.onstop=async()=>{let r=t.mimeType||"audio/webm",s=new Blob(g.current,{type:r});await k(s),e.getTracks().forEach(e=>e.stop())},t.start(),i(!0)}catch(e){p("Failed to access microphone. Please grant permission."),console.error(e)}},k=async e=>{d(!0),p(null);try{let s=new FileReader;s.readAsDataURL(e),s.onloadend=async()=>{let e=s.result.split(",")[1],a=localStorage.getItem("token"),n=await fetch("http://localhost:8000/api/v1/voice/conversation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({audio_base64:e,context:"general",conversation_history:t.slice(-6).map(e=>({role:e.role,content:e.text})),use_fast_model:!0})});if(!n.ok){let e=await n.json();throw Error(e.detail||"Voice conversation failed")}let l=await n.json();r(e=>[...e,{role:"user",text:l.transcribed_text,timestamp:new Date}]),r(e=>[...e,{role:"assistant",text:l.ai_response_text,audio:l.ai_response_audio,timestamp:new Date}]),l.ai_response_audio&&w(l.ai_response_audio)}}catch(e){p(e.message||"Failed to process audio"),console.error(e)}finally{d(!1)}},w=e=>{try{let t=N(e,"audio/wav"),r=URL.createObjectURL(t);b.current&&(b.current.src=r,b.current.play(),u(!0),b.current.onended=()=>{u(!1),URL.revokeObjectURL(r)})}catch(e){console.error("Failed to play audio:",e)}},N=(e,t)=>{let r=atob(e),s=Array(r.length);for(let e=0;e<r.length;e++)s[e]=r.charCodeAt(e);return new Blob([new Uint8Array(s)],{type:t})},P=e=>{e.audio&&w(e.audio)};return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-purple-900",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("button",{onClick:()=>e.push("/dashboard"),className:"mb-4 text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 flex items-center font-medium transition-colors",children:"← Back to Dashboard"}),s.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2",children:"\uD83C\uDFA4 Voice Conversation"}),s.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Practice German with AI voice chat - Speak naturally and get instant responses"})]}),x&&s.jsx("div",{className:"bg-red-100 dark:bg-red-900 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-6 py-4 rounded-2xl mb-6 shadow-lg",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"text-2xl",children:"⚠️"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-bold text-lg mb-1",children:"Error"}),s.jsx("p",{className:"text-sm",children:x})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 min-h-[450px] max-h-[550px] overflow-y-auto",children:0===t.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-20",children:[s.jsx("div",{className:"text-8xl mb-6 animate-pulse",children:"\uD83D\uDCAC"}),s.jsx("p",{className:"text-xl font-semibold text-gray-400 dark:text-gray-500 mb-2",children:"No messages yet"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click the microphone button below to start your conversation"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[t.map((e,t)=>s.jsx("div",{className:`flex ${"user"===e.role?"justify-end":"justify-start"} animate-fadeIn`,children:(0,s.jsxs)("div",{className:`max-w-[75%] rounded-2xl p-4 shadow-md ${"user"===e.role?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 text-gray-800 dark:text-white"}`,children:["assistant"===e.role&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:"text-2xl",children:"\uD83E\uDD16"}),s.jsx("span",{className:"text-xs font-semibold opacity-70",children:"AI Assistant"})]}),"user"===e.role&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2 justify-end",children:[s.jsx("span",{className:"text-xs font-semibold opacity-90",children:"You"}),s.jsx("span",{className:"text-2xl",children:"\uD83D\uDC64"})]}),s.jsx("p",{className:"whitespace-pre-wrap text-base leading-relaxed",children:e.text}),(0,s.jsxs)("div",{className:`flex items-center justify-between mt-3 pt-2 border-t ${"user"===e.role?"border-purple-400":"border-gray-300 dark:border-gray-500"}`,children:[s.jsx("span",{className:"text-xs opacity-70",children:e.timestamp.toLocaleTimeString()}),e.audio&&s.jsx("button",{onClick:()=>P(e),className:`px-3 py-1 rounded-lg text-xs font-bold transition-all ${"user"===e.role?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white"} disabled:opacity-50 disabled:cursor-not-allowed`,disabled:c,children:"\uD83D\uDD0A Replay"})]})]})},t)),s.jsx("div",{ref:y})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-6",children:[o&&s.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 w-full text-center border-2 border-purple-200 dark:border-purple-700",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-purple-200 border-t-purple-600"}),s.jsx("p",{className:"text-lg font-bold text-purple-700 dark:text-purple-300",children:"\uD83E\uDD16 AI is thinking..."}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Transcribing and generating response"})]})}),c&&s.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-4 w-full text-center",children:(0,s.jsxs)("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300 flex items-center justify-center gap-2",children:[s.jsx("span",{className:"text-xl animate-pulse",children:"\uD83D\uDD0A"}),"Playing AI response..."]})}),(0,s.jsxs)("div",{className:"relative",children:[l&&s.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500 animate-ping opacity-75"}),s.jsx("button",{onClick:l?()=>{f.current&&l&&(f.current.stop(),i(!1))}:v,disabled:o||c,className:`relative w-28 h-28 rounded-full flex items-center justify-center text-5xl transition-all transform hover:scale-110 shadow-2xl ${l?"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 animate-pulse":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100`,children:l?"⏹️":"\uD83C\uDFA4"})]}),(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("p",{className:`text-lg font-bold ${l?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:l?"\uD83D\uDD34 Recording... Click to stop":"⚪ Click to start recording"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:l?"Speak clearly in German":"Press and hold to speak"})]}),(0,s.jsxs)("div",{className:"w-full mt-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 border-2 border-purple-200 dark:border-purple-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx("span",{className:"text-2xl",children:"\uD83D\uDCA1"}),s.jsx("p",{className:"font-bold text-lg text-gray-800 dark:text-white",children:"How to use:"})]}),(0,s.jsxs)("ol",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[(0,s.jsxs)("li",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),s.jsx("span",{children:"Click the microphone button to start recording"})]}),(0,s.jsxs)("li",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),s.jsx("span",{children:"Speak in German (or English to practice)"})]}),(0,s.jsxs)("li",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),s.jsx("span",{children:"Click again to stop and send your message"})]}),(0,s.jsxs)("li",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"4"}),s.jsx("span",{children:"The AI will transcribe, respond, and speak back to you"})]})]})]})]})}),s.jsx("audio",{ref:b,className:"hidden"})]})})}},2643:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var s=r(4597),a=r(6591),n=r(5047);function l(){let{token:e}=(0,a.a)(),t=(0,n.useRouter)();return(0,s.useEffect)(()=>{try{e||t.replace("/login")}catch{e||t.replace("/login")}},[e,t]),null}},8318:(e,t,r)=>{"use strict";r.d(t,{default:()=>a.a});var s=r(4567),a=r.n(s)},4567:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let s=r(3370);r(9510),r(1159);let a=s._(r(6155));function n(e,t){var r;let s={loading:e=>{let{error:t,isLoading:r,pastDelay:s}=e;return null}};"function"==typeof e&&(s.loader=e);let n={...s,...t};return(0,a.default)({...n,modules:null==(r=n.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3689:(e,t,r)=>{"use strict";let{createProxy:s}=r(8570);e.exports=s("/Users/saud06/CascadeProjects/german-ai/frontend/node_modules/next/dist/shared/lib/lazy-dynamic/dynamic-bailout-to-csr.js")},6155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let s=r(9510),a=r(1159),n=r(3689),l=r(4459);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},r=(0,a.lazy)(()=>t.loader().then(i)),d=t.loading;function c(e){let i=d?(0,s.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=t.ssr?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.PreloadCss,{moduleIds:t.modules}),(0,s.jsx)(r,{...e})]}):(0,s.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(r,{...e})});return(0,s.jsx)(a.Suspense,{fallback:i,children:o})}return c.displayName="LoadableComponent",c}},4459:(e,t,r)=>{"use strict";let{createProxy:s}=r(8570);e.exports=s("/Users/saud06/CascadeProjects/german-ai/frontend/node_modules/next/dist/shared/lib/lazy-dynamic/preload-css.js")},7798:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(9510),a=r(8318),n=r(4068);let l=(0,a.default)(()=>r.e(307).then(r.bind(r,1307)),{loadableGenerated:{modules:["app/voice-chat/page.tsx -> ./VoiceChatClient"]},ssr:!1,loading:()=>s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading Voice Chat..."})]})})});function i(){return(0,s.jsxs)(s.Fragment,{children:[s.jsx(n.ZP,{}),s.jsx(l,{})]})}},4068:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>i});var s=r(8570);let a=(0,s.createProxy)(String.raw`/Users/saud06/CascadeProjects/german-ai/frontend/src/components/RequireAuth.tsx`),{__esModule:n,$$typeof:l}=a;a.default;let i=(0,s.createProxy)(String.raw`/Users/saud06/CascadeProjects/german-ai/frontend/src/components/RequireAuth.tsx#default`)},7026:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(6621);let a=e=>[{type:"image/svg+xml",sizes:"any",url:(0,s.fillMetadataSegment)(".",e.params,"icon.svg")+"?d88cf511049578a4"}]}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,102,621,871],()=>r(3244));module.exports=s})();