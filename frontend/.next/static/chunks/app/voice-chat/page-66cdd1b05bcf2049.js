(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[947],{7396:function(e,t,r){Promise.resolve().then(r.bind(r,912)),Promise.resolve().then(r.bind(r,1481)),Promise.resolve().then(r.bind(r,5395)),Promise.resolve().then(r.bind(r,9002))},6463:function(e,t,r){"use strict";var a=r(1169);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},3196:function(e,t,r){"use strict";r.d(t,{d4:function(){return a.useEffect}});var a=r(1196)},3266:function(e,t,r){"use strict";r.d(t,{d4:function(){return a.useEffect},eJ:function(){return a.useState},mT:function(){return a.useRef}});var a=r(1196)},912:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let a=r(5592);function s(e){let{reason:t,children:r}=e;if("undefined"==typeof window)throw new a.BailoutToCSRError(t);return r}},1481:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let a=r(3619),s=r(8512);function n(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let r=(0,s.getExpectedRequestStore)("next/dynamic css"),n=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,a.jsx)(a.Fragment,{children:n.map(e=>(0,a.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},4492:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a=r(1196),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=a.useState,l=a.useEffect,o=a.useLayoutEffect,i=a.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!s(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),a=n({inst:{value:r,getSnapshot:t}}),s=a[0].inst,u=a[1];return o(function(){s.value=r,s.getSnapshot=t,c(s)&&u({inst:s})},[e,r,t]),l(function(){return c(s)&&u({inst:s}),e(function(){c(s)&&u({inst:s})})},[e]),i(r),r};t.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:u},5107:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a=r(1196),s=r(554),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},l=s.useSyncExternalStore,o=a.useRef,i=a.useEffect,c=a.useMemo,u=a.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,a,s){var d=o(null);if(null===d.current){var m={hasValue:!1,value:null};d.current=m}else m=d.current;var x=l(e,(d=c(function(){function e(e){if(!i){if(i=!0,l=e,e=a(e),void 0!==s&&m.hasValue){var t=m.value;if(s(t,e))return o=t}return o=e}if(t=o,n(l,e))return t;var r=a(e);return void 0!==s&&s(t,r)?t:(l=e,o=r)}var l,o,i=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,r,a,s]))[0],d[1]);return i(function(){m.hasValue=!0,m.value=x},[x]),u(x),x}},554:function(e,t,r){"use strict";e.exports=r(4492)},5006:function(e,t,r){"use strict";e.exports=r(5107)},5395:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(3619),s=r(3266),n=r(6463);function l(){let e=(0,n.useRouter)(),[t,r]=(0,s.eJ)([]),[l,o]=(0,s.eJ)(!1),[i,c]=(0,s.eJ)(!1),[u,d]=(0,s.eJ)(!1),[m,x]=(0,s.eJ)(null),[p,f]=(0,s.eJ)(null),h=(0,s.mT)(null),g=(0,s.mT)([]),b=(0,s.mT)(null),y=(0,s.mT)(null);(0,s.d4)(()=>{v()},[]),(0,s.d4)(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let v=async()=>{try{let e=await fetch("".concat("http://localhost:8000/api/v1","/voice/status")),t=await e.json();f(t),t.voice_features_enabled||x("Voice features are not enabled on the server. Please ensure Whisper and Piper services are running.")}catch(e){x("Failed to check voice service status. Please ensure the backend is running."),console.error(e)}},j=async()=>{try{x(null);let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);h.current=t,g.current=[],t.ondataavailable=e=>{e.data.size>0&&g.current.push(e.data)},t.onstop=async()=>{let r=t.mimeType||"audio/webm",a=new Blob(g.current,{type:r});await k(a),e.getTracks().forEach(e=>e.stop())},t.start(),o(!0)}catch(e){x("Failed to access microphone. Please grant permission."),console.error(e)}},k=async e=>{c(!0),x(null);try{let a=new FileReader;a.readAsDataURL(e),a.onloadend=async()=>{let e=a.result.split(",")[1],s=localStorage.getItem("token"),n=await fetch("".concat("http://localhost:8000/api/v1","/voice/conversation"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({audio_base64:e,context:"general",conversation_history:t.slice(-6).map(e=>({role:e.role,content:e.text})),use_fast_model:!0})});if(!n.ok){let e=await n.json();throw Error(e.detail||"Voice conversation failed")}let l=await n.json();r(e=>[...e,{role:"user",text:l.transcribed_text,timestamp:new Date}]),r(e=>[...e,{role:"assistant",text:l.ai_response_text,audio:l.ai_response_audio,timestamp:new Date}]),l.ai_response_audio&&w(l.ai_response_audio)}}catch(e){x(e.message||"Failed to process audio"),console.error(e)}finally{c(!1)}},w=e=>{try{let t=N(e,"audio/wav"),r=URL.createObjectURL(t);b.current&&(b.current.src=r,b.current.play(),d(!0),b.current.onended=()=>{d(!1),URL.revokeObjectURL(r)})}catch(e){console.error("Failed to play audio:",e)}},N=(e,t)=>{let r=atob(e),a=Array(r.length);for(let e=0;e<r.length;e++)a[e]=r.charCodeAt(e);return new Blob([new Uint8Array(a)],{type:t})},S=e=>{e.audio&&w(e.audio)};return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-purple-900",children:(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"mb-4 text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 flex items-center font-medium transition-colors",children:"← Back to Dashboard"}),(0,a.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2",children:"\uD83C\uDFA4 Voice Conversation"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Practice German with AI voice chat - Speak naturally and get instant responses"})]}),m&&(0,a.jsx)("div",{className:"bg-red-100 dark:bg-red-900 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-6 py-4 rounded-2xl mb-6 shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"⚠️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-lg mb-1",children:"Error"}),(0,a.jsx)("p",{className:"text-sm",children:m})]})]})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-6 min-h-[450px] max-h-[550px] overflow-y-auto",children:0===t.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-20",children:[(0,a.jsx)("div",{className:"text-8xl mb-6 animate-pulse",children:"\uD83D\uDCAC"}),(0,a.jsx)("p",{className:"text-xl font-semibold text-gray-400 dark:text-gray-500 mb-2",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click the microphone button below to start your conversation"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[t.map((e,t)=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"," animate-fadeIn"),children:(0,a.jsxs)("div",{className:"max-w-[75%] rounded-2xl p-4 shadow-md ".concat("user"===e.role?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 text-gray-800 dark:text-white"),children:["assistant"===e.role&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83E\uDD16"}),(0,a.jsx)("span",{className:"text-xs font-semibold opacity-70",children:"AI Assistant"})]}),"user"===e.role&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 justify-end",children:[(0,a.jsx)("span",{className:"text-xs font-semibold opacity-90",children:"You"}),(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC64"})]}),(0,a.jsx)("p",{className:"whitespace-pre-wrap text-base leading-relaxed",children:e.text}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-2 border-t ".concat("user"===e.role?"border-purple-400":"border-gray-300 dark:border-gray-500"),children:[(0,a.jsx)("span",{className:"text-xs opacity-70",children:e.timestamp.toLocaleTimeString()}),e.audio&&(0,a.jsx)("button",{onClick:()=>S(e),className:"px-3 py-1 rounded-lg text-xs font-bold transition-all ".concat("user"===e.role?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white"," disabled:opacity-50 disabled:cursor-not-allowed"),disabled:u,children:"\uD83D\uDD0A Replay"})]})]})},t)),(0,a.jsx)("div",{ref:y})]})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-6",children:[i&&(0,a.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 w-full text-center border-2 border-purple-200 dark:border-purple-700",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-purple-200 border-t-purple-600"}),(0,a.jsx)("p",{className:"text-lg font-bold text-purple-700 dark:text-purple-300",children:"\uD83E\uDD16 AI is thinking..."}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Transcribing and generating response"})]})}),u&&(0,a.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-4 w-full text-center",children:(0,a.jsxs)("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300 flex items-center justify-center gap-2",children:[(0,a.jsx)("span",{className:"text-xl animate-pulse",children:"\uD83D\uDD0A"}),"Playing AI response..."]})}),(0,a.jsxs)("div",{className:"relative",children:[l&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-red-500 animate-ping opacity-75"}),(0,a.jsx)("button",{onClick:l?()=>{h.current&&l&&(h.current.stop(),o(!1))}:j,disabled:i||u,className:"relative w-28 h-28 rounded-full flex items-center justify-center text-5xl transition-all transform hover:scale-110 shadow-2xl ".concat(l?"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 animate-pulse":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600"," text-white disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"),children:l?"⏹️":"\uD83C\uDFA4"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-lg font-bold ".concat(l?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"),children:l?"\uD83D\uDD34 Recording... Click to stop":"⚪ Click to start recording"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:l?"Speak clearly in German":"Press and hold to speak"})]}),(0,a.jsxs)("div",{className:"w-full mt-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 border-2 border-purple-200 dark:border-purple-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCA1"}),(0,a.jsx)("p",{className:"font-bold text-lg text-gray-800 dark:text-white",children:"How to use:"})]}),(0,a.jsxs)("ol",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),(0,a.jsx)("span",{children:"Click the microphone button to start recording"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),(0,a.jsx)("span",{children:"Speak in German (or English to practice)"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),(0,a.jsx)("span",{children:"Click again to stop and send your message"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"4"}),(0,a.jsx)("span",{children:"The AI will transcribe, respond, and speak back to you"})]})]})]})]})}),(0,a.jsx)("audio",{ref:b,className:"hidden"})]})})}},9002:function(e,t,r){"use strict";r.d(t,{default:function(){return l}});var a=r(3196),s=r(8588),n=r(6463);function l(){let{token:e}=(0,s.a)(),t=(0,n.useRouter)();return(0,a.d4)(()=>{try{let r=localStorage.getItem("token");e||r||t.replace("/login")}catch(r){e||t.replace("/login")}},[e,t]),null}},8588:function(e,t,r){"use strict";let a;r.d(t,{a:function(){return x}});let s=e=>{let t;let r=new Set,a=(e,a)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=a?a:"object"!=typeof s||null===s)?s:Object.assign({},t,s),r.forEach(r=>r(t,e))}},s=()=>t,n={setState:a,getState:s,getInitialState:()=>l,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},l=t=e(a,s,n);return n},n=e=>e?s(e):s;var l=r(1196),o=r(5006);let{useDebugValue:i}=l,{useSyncExternalStoreWithSelector:c}=o,u=!1,d=e=>e,m=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?n(e):e,r=(e,r)=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d,r=arguments.length>2?arguments[2]:void 0;r&&!u&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),u=!0);let a=c(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return i(a),a})(t,e,r);return Object.assign(r,t),r},x=(a=e=>({token:localStorage.getItem("token"),userId:localStorage.getItem("user_id"),name:localStorage.getItem("user_name"),email:localStorage.getItem("user_email"),setAuth:(t,r)=>{localStorage.setItem("token",t),localStorage.setItem("user_id",r),e({token:t,userId:r})},setProfile:(t,r)=>{try{localStorage.setItem("user_name",t),localStorage.setItem("user_email",r)}catch(e){}e({name:t,email:r})},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user_id"),localStorage.removeItem("user_name"),localStorage.removeItem("user_email"),e({token:null,userId:null,name:null,email:null})}}))?m(a):m}},function(e){e.O(0,[971,23,744],function(){return e(e.s=7396)}),_N_E=e.O()}]);