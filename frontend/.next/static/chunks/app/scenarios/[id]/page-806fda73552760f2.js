(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[646],{3288:function(e,t,a){Promise.resolve().then(a.bind(a,5792))},6463:function(e,t,a){"use strict";var r=a(1169);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},3266:function(e,t,a){"use strict";a.d(t,{d4:function(){return r.useEffect},eJ:function(){return r.useState},mT:function(){return r.useRef}});var r=a(1196)},5792:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var r=a(3619),s=a(3266),i=a(6463),n=a(1196);function d(e){let{onRecordingComplete:t,disabled:a}=e,[s,i]=(0,n.useState)(!1),[d,l]=(0,n.useState)(!1),o=(0,n.useRef)(null),c=(0,n.useRef)([]),g=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(e);o.current=a,c.current=[],a.ondataavailable=e=>{e.data.size>0&&c.current.push(e.data)},a.onstop=async()=>{l(!0);let a=new Blob(c.current,{type:"audio/webm"}),r=new FileReader;r.onloadend=()=>{let e=r.result.split(",")[1];t(e),l(!1)},r.readAsDataURL(a),e.getTracks().forEach(e=>e.stop())},a.start(),i(!0)}catch(e){console.error("Error accessing microphone:",e),alert("Could not access microphone. Please check permissions.")}};return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[s?(0,r.jsx)("button",{onClick:()=>{o.current&&s&&(o.current.stop(),i(!1))},className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors animate-pulse",title:"Stop recording",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z",clipRule:"evenodd"})})}):(0,r.jsx)("button",{onClick:g,disabled:a||d,className:"p-3 rounded-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white transition-colors",title:"Hold to record",children:d?(0,r.jsxs)("svg",{className:"w-6 h-6 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})})}),s&&(0,r.jsx)("span",{className:"text-sm text-red-500 dark:text-red-400 animate-pulse",children:"Recording..."})]})}function l(){let e=(0,i.useRouter)(),t=(0,i.useParams)().id,a=(0,s.mT)(null),[n,l]=(0,s.eJ)(null),[o,c]=(0,s.eJ)(null),[g,x]=(0,s.eJ)(!0),[m,h]=(0,s.eJ)(!1),[u,p]=(0,s.eJ)(!1),[b,f]=(0,s.eJ)(""),[y,j]=(0,s.eJ)(""),v=e=>e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());(0,s.d4)(()=>{k(),N()},[t]);let k=async()=>{try{let e=localStorage.getItem("token"),a=await fetch("http://localhost:8000/api/v1/scenarios/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok)throw Error("Failed to fetch scenario");let r=await a.json();l(r.scenario)}catch(e){j(e instanceof Error?e.message:"Failed to load scenario")}finally{x(!1)}},N=async()=>{try{let e=localStorage.getItem("token"),a=await fetch("http://localhost:8000/api/v1/scenarios/".concat(t,"/state"),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();c(e.state)}else 404===a.status&&c(null)}catch(e){}},w=()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"nearest"})};(0,s.d4)(()=>{(null==o?void 0:o.messages)&&"completed"!==o.status&&w()},[null==o?void 0:o.messages,null==o?void 0:o.status]);let S=async()=>{if(n&&n.characters[0]){h(!0),j("");try{let e=localStorage.getItem("token"),a=n.characters[0].id,r=await fetch("http://localhost:8000/api/v1/scenarios/".concat(t,"/start?character_id=").concat(a),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){let e=await r.json();throw Error(e.detail||"Failed to start scenario")}await N()}catch(e){j(e instanceof Error?e.message:"Failed to start scenario")}finally{h(!1)}}},C=async()=>{if(!b.trim()||u)return;let e=b.trim();p(!0),j(""),f("");try{var a;let r=localStorage.getItem("token");o&&c({...o,messages:[...o.messages,{role:"user",content:e,timestamp:new Date().toISOString()}]});let s=await fetch("http://localhost:8000/api/v1/scenarios/".concat(t,"/message/stream"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({message:e})});if(!s.ok)throw Error("Failed to send message");let i=null===(a=s.body)||void 0===a?void 0:a.getReader(),n=new TextDecoder,d="",l=!1;if(i)for(;;){let{done:e,value:t}=await i.read();if(e)break;for(let e of n.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if("token"===t.type){if(d+=t.content,o){let e=[...o.messages],t=e[e.length-1];t&&"character"===t.role?t.content=d:e.push({role:"character",content:d,timestamp:new Date().toISOString()}),c({...o,messages:e})}}else if("complete"===t.type)l=t.conversation_complete||!1;else if("error"===t.type)throw Error(t.message)}catch(e){console.error("Error parsing SSE data:",e)}}let g=await fetch("http://localhost:8000/api/v1/scenarios/".concat(t,"/state"),{headers:{Authorization:"Bearer ".concat(r)}});if(g.ok){let e=await g.json();c(e.state),("completed"===e.state.status||l)&&c({...e.state,status:"completed"})}}catch(t){j(t instanceof Error?t.message:"Failed to send message"),f(e)}finally{p(!1)}},D=async e=>{if(!u){p(!0),j("");try{let a=localStorage.getItem("token"),r=await fetch("http://localhost:8000/api/v1/scenarios/".concat(t,"/voice-message"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({audio_base64:e})});if(!r.ok){let e=await r.json();throw Error(e.detail||"Failed to send voice message")}let s=await r.json();if(o&&c({...o,messages:[...o.messages,{role:"user",content:s.transcribed_text,timestamp:new Date().toISOString()}]}),o&&c({...o,messages:[...o.messages,{role:"user",content:s.transcribed_text,timestamp:new Date().toISOString()},{role:"character",content:s.character_message,timestamp:new Date().toISOString(),audio:s.character_audio}]}),s.character_audio)try{new Audio("data:audio/wav;base64,".concat(s.character_audio)).play()}catch(e){console.error("Failed to play audio:",e)}await N(),s.conversation_complete&&o&&c({...o,status:"completed"})}catch(e){j(e instanceof Error?e.message:"Failed to send voice message")}finally{p(!1)}}},_=e=>{if(!o)return!1;let t=o.objectives_progress.find(t=>t.objective_id===e);return(null==t?void 0:t.completed)||!1},A=()=>n&&o?Math.round(o.objectives_progress.filter(e=>e.completed).length/n.objectives.length*100):0;if(g)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-indigo-600"})});if(!n)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-lg",children:"Scenario not found"}),(0,r.jsx)("button",{onClick:()=>e.push("/scenarios"),className:"mt-4 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300",children:"← Back to Scenarios"})]})});let R=n.characters[0];return o?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Learning Objectives"}),(0,r.jsx)("div",{className:"space-y-2",children:n.objectives.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:_(e.id)?(0,r.jsx)("span",{className:"text-green-500 text-xl",children:"✓"}):(0,r.jsx)("span",{className:"text-gray-400 dark:text-gray-500 text-xl",children:"○"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-gray-800 dark:text-gray-200 font-medium flex-1",children:e.description}),e.hint&&!_(e.id)&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["\uD83D\uDCA1 ",e.hint]})]}),_(e.id)?(0,r.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-2 py-1 rounded",children:"✓ Completed"}):e.required?(0,r.jsx)("span",{className:"text-xs bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 px-2 py-1 rounded",children:"Required"}):(0,r.jsx)("span",{className:"text-xs bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 px-2 py-1 rounded",children:"Optional"})]},e.id))}),(0,r.jsxs)("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[(0,r.jsx)("span",{children:"Progress"}),(0,r.jsxs)("span",{children:[A(),"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full transition-all",style:{width:"".concat(A(),"%")}})})]}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-indigo-50 dark:bg-indigo-900 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-indigo-900 dark:text-indigo-200",children:"Score"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-300",children:o.score})]})})]})}),(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md flex flex-col",style:{height:"600px"},children:["completed"===o.status&&(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-3xl",children:"\uD83C\uDF89"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold text-lg",children:"Scenario Completed!"}),(0,r.jsx)("p",{className:"text-sm opacity-90",children:"Great job! You've completed all objectives."})]})]}),(0,r.jsx)("button",{onClick:()=>e.back(),className:"bg-white text-green-600 px-4 py-2 rounded-lg font-medium hover:bg-green-50 transition",children:"← Back to Scenarios"})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.messages.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[80%] rounded-lg p-4 ".concat("user"===e.role?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100"),children:["character"===e.role&&(0,r.jsx)("p",{className:"text-xs font-medium mb-1 opacity-70",children:R.name}),(0,r.jsx)("p",{className:"text-sm",children:e.content})]})},t)),u&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-4 max-w-[80%]",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"animate-pulse",children:"\uD83D\uDCAD"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Typing..."})]})})}),(0,r.jsx)("div",{ref:a})]}),(0,r.jsxs)("div",{className:"border-t dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-900",children:[y&&(0,r.jsx)("div",{className:"mb-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-3 py-2 rounded text-sm",children:y}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:b,onChange:e=>f(e.target.value),onKeyPress:e=>"Enter"===e.key&&C(),placeholder:"Type your message in German...",disabled:u,className:"flex-1 px-4 py-2 border dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"}),(0,r.jsx)(d,{onRecordingComplete:D,disabled:u}),(0,r.jsx)("button",{onClick:C,disabled:u||!b.trim(),className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition disabled:opacity-50",children:u?"...":"Send"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"\uD83D\uDCA1 Tip: Type or speak your message in German. Complete objectives using the suggested keywords!"})]})]})})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsx)("button",{onClick:()=>e.push("/scenarios"),className:"mb-4 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300",children:"← Back to Scenarios"}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-8 text-white",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:n.icon||"\uD83C\uDFAD"}),(0,r.jsx)("h1",{className:"text-4xl font-bold mb-2",children:n.name}),(0,r.jsx)("p",{className:"text-indigo-100 text-lg",children:n.title_en})]}),(0,r.jsxs)("div",{className:"p-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"About this scenario"}),(0,r.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mb-2",children:n.description}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 italic",children:n.description_en})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Character"}),n.characters&&n.characters.length>0&&R&&(0,r.jsxs)("div",{className:"flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,r.jsx)("div",{className:"text-4xl",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-gray-800 dark:text-gray-200 font-medium text-lg",children:R.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:v(R.role)}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:v(R.personality)}),R.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 italic",children:R.description})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Learning objectives"}),(0,r.jsx)("div",{className:"space-y-2",children:n.objectives.map((e,t)=>{let a=_(e.id);return(0,r.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded-lg ".concat(a?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700"),children:[(0,r.jsx)("span",{className:"flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-sm font-medium ".concat(a?"bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-200":"bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300"),children:a?"✓":t+1}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-medium ".concat(a?"text-green-700 dark:text-green-300 line-through":"text-gray-800 dark:text-gray-200"),children:e.description}),e.hint&&!a&&(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["\uD83D\uDCA1 ",e.hint]})]}),(0,r.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded ".concat(a?"bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300"),children:a?"Completed":"Required"})]},e.id)})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-6 mb-8 text-gray-600 dark:text-gray-400",children:[(0,r.jsxs)("span",{children:["\uD83D\uDCCA Difficulty: ",(0,r.jsx)("strong",{children:n.difficulty})]}),(0,r.jsxs)("span",{children:["⏱️ Duration: ",(0,r.jsxs)("strong",{children:[n.estimated_duration," min"]})]}),(0,r.jsxs)("span",{children:["\uD83C\uDFAF Objectives: ",(0,r.jsx)("strong",{children:n.objectives.length})]}),o&&(0,r.jsxs)("span",{className:"text-green-600 dark:text-green-400",children:["✅ Progress: ",(0,r.jsxs)("strong",{children:[A(),"%"]})]})]}),y&&(0,r.jsx)("div",{className:"mb-6 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded",children:y}),(0,r.jsx)("button",{onClick:S,disabled:m,className:"w-full bg-indigo-600 text-white py-4 rounded-lg font-medium text-lg hover:bg-indigo-700 transition disabled:opacity-50",children:m?"Starting...":"Start Conversation with ".concat(R.name," →")})]})]})]})})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=3288)}),_N_E=e.O()}]);